
<style type="text/css">
.button {
  font-family: Monospace, "Courier New", Courier;
  background-color: #E0E0E0;
  font-size: small;
  padding: 0.05em
}
</style>

<h2 class='navinfo'>Normal Mode Wizard, Version 1.0</h2>

<div style="float: left; padding: 10 30 10 10">
<img src="nmwiz_logo.png">
<div style="text-align: center; font-size: small">Normal Mode Wizard</div>
</div>

Normal Mode Wizard (NMWiz) is for visual comparative analysis of 
normal mode data. Normal modes may come from 

<ul>
  <li>normal mode analysis (NMA) of elastic network models (ENMs), e.g. ANM/GNM</li>
  <li>force-field based all-atom NMA</li>
  <li>principal component analysis (PCA) of experimental structural ensembles</li>
  <li>essential dynamics analysis (EDA) of molecular dynamics trajectories</li>
</ul>

<b>NMWiz</b> can be used for:

<ul>
  <li>drawing normal modes arrows</li>
  <li>making animations (conformations along a normal mode)</li>
  <li>plotting square-fluctuations (labeling and highlighting residues)</li>
  <li>comparing two structures and drawing deformation arrows</li>
</ul>


Some examples prepared using NMWiz are shown below: 

<table>
  <tr>
    <td style="text-align: center; font-size: small"><img src="p38_anm_pca_sm.png"><br/>ANM modes for p38 MAPK</td>
    <td style="text-align: center; font-size: small"><img src="p38_modes_123_sm.png"><br/>ANM vs. PCA modes for p38</td>
    <td style="text-align: center; font-size: small"><img src="p38_network_sm.png"><br/>p38 network model</td>
  </tr>
</table>

<h3>How to use NMWiz</h3>

Normal mode data can be fed into NMWiz in two ways: 

<ol>
  <li><i>NMD files:</i> NMWiz can read <b>.nmd</b> files 
    (<span class="button">Load NMD file</span>) which can be generated using 
    <a href="http://www.csb.pitt.edu/prody/">ProDy</a> or obtained from the 
    <a href="http://ignmtest.ccbb.pitt.edu/cgi-bin/anm/anm1.cgi">ANM server</a>. 
    Alternatively, one can prepare an NMD file using a simple text editor. 
    See <a href="#nmd">NMD format</a> for details.</li>
  <li><i>VMD recognized formats:</i> NMWiz can retrieve normal mode data
    from molecules loaded in VMD, so it supports all file formats that are
    supported by VMD. After reading data files, click <span class="button">
    From Molecule</span>. 
    See <a href="http://www.ks.uiuc.edu/Research/vmd/plugins/molfile/">
    Molfile Plugin</a> documentation for supported formats.</li>
</ol>


<div style="float: right">
<table>
  <tr>
    <td style="text-align: center"><a href="nmwiz_main.png"><img src="nmwiz_main.png" style="height: 75%"></a></td>    
  </tr>
  <tr>
    <td style="text-align: center; font-size: small">NMWiz Main Window</td>    
  </tr>
  <tr>
    <td style="text-align: center"><a href="nmwiz_gui.png"><img src="nmwiz_gui.png" style="height: 75%"></a></td>    
  </tr>
  <tr>
    <td style="text-align: center; font-size: small">NMWiz GUI</td>    
  </tr>
  <tr>
    <td style="text-align: center"><a href="nmwiz_frommolecule.png"><img src="nmwiz_frommolecule.png" style="height: 75%"></a></td>    
  </tr>
  <tr>
    <td style="text-align: center; font-size: small">From Molecule</td>    
  </tr>
  <tr>
    <td style="text-align: center"><a href="nmwiz_multiplot.png"><img src="nmwiz_multiplot.png" style="height: 75%"></a></td>    
  </tr>
  <tr>
    <td style="text-align: center; font-size: small">Mobility Plot</td>    
  </tr>
  <tr>
    <td style="text-align: center"><a href="nmwiz_prody.png"><img src="nmwiz_prody.png" style="height: 75%"></a></td>    
  </tr>
  <tr>
    <td style="text-align: center; font-size: small">ProDy Interface</td>    
  </tr>
  <tr>
    <td style="text-align: center"><a href="nmwiz_comparison.png"><img src="nmwiz_comparison.png" style="height: 75%"></a></td>    
  </tr>
  <tr>
    <td style="text-align: center; font-size: small">Structure Comparison</td>    
  </tr>
</table>
</div>

NMWiz can also be used to generate data:

<ul>
  <li><i>ProDy Interface:</i> This interface allows for running ANM, GNM, or 
    PCA/EDA jobs using ProDy installed on user's machine. 
    Click <span class="button">ProDy Interface</span> to open the interface.  
    See <a href="http://www.csb.pitt.edu/prody/">ProDy website</a> for downloads 
    and installation instructions.
  <li><i>Structure Comparison:</i> NMWiz can compare two structures and draw
    deformation vector arrows to depict structural change. Click 
    <span class="button">Structure Comparison</span> to open this interface.</li>
</ul>


For each dataset loaded in NMWiz a series of buttons will appear in the main 
window. <span class="button">GUI</span> button recovers the GUI for a 
dataset when it is closed. <span class="button">Remove</span> completely 
removes the dataset from the memory. <span class="button">Save</span> writes 
the data on disk in <a href="#nmd">NMD format</a>.

<p><i>Tips</i>
<br/>To get instant help click <span class="button">Help</span>.</p>



<h3>NMWiz GUI</h3>

<p>A NMWiz GUI is generated for each dataset loaded into NMWiz. 
These interfaces are independent of each other, hence allow for comparison of 
different data sets.</p>

<p>NMWiz GUI allows for visualizing, animating, and plotting modes.  
Arrow size, animation length, graphics quality etc. can be adjusted using 
<span class="button">Option</span> panels after they are switched on.</p>
These panels are hidden from user at startup. 

<p><b>Active Mode and Color</b></p>

<p>The top panel enables choosing the active mode and color. When the active 
mode is changed, previously drawn mode arrows will be undisplayed. This 
behavior and other graphics options can be changed from the 
"Arrow Graphics Option" panel.</p>

<p><i>Tips</i>
<br/>When visualizing a large system, keep the resolution low while making
adjustments for a more responsive experience.
<br/>If the arrow graphics are too crowded, draw arrows for a subset of 
residues that are evenly spaced, e.g. try the selection string 
<span class="button">residue % 4 == 0</span>, which will draw an arrow for 
every fourth residue.</p>


<h3>From Molecule</h3>

This interface can be used retrieve data from a molecule which contains normal 
modes as frames. In the following examples mode data are provided in 
Gromacs TRR or PDB formats:

<ul>
  <li><a href="lysozyme.zip">Lysozyme example</a> contains 10 modes from 
    all-atom NMA calculations (courtesy of Guang Hu). Coordinate data is in 
    GRO format and mode data is in TRR format. 
  </li>
  <li><a href="ubiquitin.zip">Ubiquitin example</a> contains 10 modes from 
    all-atom PCA calculations for the PDB structure 2K39. Both coordinate and
    mode data are in PDB format. The zip archive also contains the same data 
    in NMD format.
  </li>
</ul>
 


When retrieving data from a large molecular system, you can choose to get data 
for select atoms, e.g. <span class="button">name CA and protein</span> will 
retrieve parts of normal modes matching carbon alpha atoms.


<h3>Mobility Plots</h3>

<p>Square-fluctuations for the active normal mode can be plotted by clicking 
on the <span class="button">Plot</span> button. Plots will be generated using 
MultiPlot plugin.</p>

<p><i>Tip:</i> Clicking on the plot will label and highlight the residue 
(or atom) in the VMD display.</p>

<h3>ProDy Interface</h3>


<p>ProDy interface allows users to submit ANM, GNM, and PCA/EDA calculations 
for proteins loaded in VMD.  User needs to download and install 
<a href="http://www.csb.pitt.edu/ProDy">ProDy</a> v0.9 or later.</p>

<p>ProDy interface lists molecules available for calculations.
If all molecules loaded in VMD are not displayed, click <span class="button">
Update</span>. ANM and GNM calculations require a coordinate set. PCA 
calculations require multiple coordinate sets. Note that you can perform 
atomistic calculations by changing the atom selection. If you perform atomistic
ANM or GNM calculations adjust the cutoff distance parameter accordingly.
Upon completion of the calculations, NMWiz automatically loads the results.</p>


<h3>Structure Comparison</h3>
<p>NMWiz can be used to generate deformation vector arrows for a pair related 
molecules or a pair of frames loaded for the same molecule.</p> 

<p>This interface lists molecules available for comparison.
If all molecules loaded in VMD are not displayed, click <span class="button">
Update</span>. 
User needs to make a selections for both molecules that will result 
in selecting the same number of atoms. NMWiz will generate arrows between 
atoms in these selections.</p>

<a name="nmd"><h3>NMD format</h3></a>

<p>NMD files (extension .nmd) are plain text files that contain at least normal 
mode and coordinate data.  PCA, EDA, NMA, ANM, or GNM data can be stored in
NMD files. Recognized data fields are listed below, those
required are emphasized.</p>
<p><b>coordinates</b> - Coordinates must be provided in one line as a list of 
decimal numbers. Number of atoms in the system is deduced from size of this
data line.
<br/><b>mode</b> - Normal mode array. Each normal mode array must be provided in 
one line as a list of decimal numbers. Mode array may be preceded by mode index
and mode length (square root of variance or inverse of frequency).
<br/><i>title</i> - A title for the dataset.
<br/><i>names</i> - Atom names. Default is "CA" for all atoms.
<br/><i>resnames</i>: Residue names. Default value is "GLY".
<br/><i>chainids</i>: Chain identifiers. Default value is "A".
<br/><i>resids</i>: Residue numbers. If this data line if not found, residue 
numbers are started from 1 and incremented by one for each atom.
<br/><i>betas</i>: Beta factors. Default value is 0 (zero). B-factors are used 
to color the protein representation.</p>

<p>Note that all data types must be listed in a single line. The size
of data lines must match the number of atoms in the system (the size of 
<i>coordinates</i> line).</p>

<p><b>NMD file example (all lines are truncated):</b></p>

<pre class="button">
title 1p38_anm
names CA CA CA ...
resnames GLU ARG PRO ...
chids A A A ...
resnums 4 5 6 ...
betas 69.99 59.83 47.29 ...
coordinates 27.552 4.354 23.629 24.179 4.807 21.907 ...
mode 1 2.37 0.039 0.009 0.058 0.038 -0.011 0.052 ...
mode 2 1.73 -0.045 -0.096 -0.009 -0.040 -0.076 -0.010 ...
mode 3 1.70 0.007 -0.044 0.080 0.015 -0.037 0.062 0.012 ...
</pre>

<p>The complete file can be downloaded from here: 
<a href="p38_MAPK_1p38_anm.zip">p38_MAPK_1p38_anm.zip</a>
</p>  

<a name="nmd"><h3>NMWiz commands</h3></a>

NMWiz commands allows user to get and set coordinate and mode arrays and
adding new modes. This features can be used to generate linear combinations 
of modes and adding them to the dataset. See the example at the end:

The following top level commands are available:
<p>
<span class="button">nmwiz list</span> &nbsp; lists all existing normal mode dataset handles </br>
<span class="button">nmwiz load</span> &nbsp; loads a dataset in NMD format </br>
<span class="button">nmwiz main</span> &nbsp; shows NMWiz main window 
</p>

You can get a handle of a dataset as follows:
<pre class="button">
set nmdhandle [nmwiz load p38_MAPK_1p38_anm.nmd]
</pre>

Or you can use the list command:
<pre class="button">
set nmdhandle [lindex [nmwiz list] 0]
</pre>

This handle can be used with the following commands:

<p>
<span class="button">$nmdhandle numatoms</span> &nbsp; get number of atoms </br>
<span class="button">$nmdhandle getcoords</span> &nbsp; get a list of all existing normal mode dataset handles </br>
<span class="button">$nmdhandle setcoords <i>array</i></span> &nbsp; set molecule coordinates </br>
<span class="button">$nmdhandle nummodes</span> &nbsp; get number of modes </br>
<span class="button">$nmdhandle getmode <i>index</i></span> &nbsp; get mode array  </br>
<span class="button">$nmdhandle setmode <i>index</i> <i>array</i></span> &nbsp; set mode array </br>
<span class="button">$nmdhandle getlen <i>index</i></span> &nbsp; get index of mode </br>
<span class="button">$nmdhandle setlen <i>index</i> <i>length</i></span> &nbsp; set length of mode</br>
<span class="button">$nmdhandle addmode <i>array</i></span> &nbsp; add new mode </br>
</p>

<p><b>Combining modes:</b></p>

The following examples shows how to combine two modes linearly after scaling 
them by their lengths:

<pre class="button">
set nmdhandle [lindex [nmwiz list] end]
set m1 [$nmdhandle getmode 1]
set l1 [$nmdhandle getlen 1]
set m2 [$nmdhandle getmode 2]
set l2 [$nmdhandle getlen 2]
$nmdhandle addmode [vecadd [vecscale $l1 $m1] [vecscale $l2 $m2]]
</pre>

<p><b>Inverting a mode:</b></p>

The following examples shows how to invert a mode:

<pre class="button">
set nmdhandle [lindex [nmwiz list] end]
set m1 [$nmdhandle getmode 1]
$nmdhandle setmode 1 [vecinvert $m1]
</pre>


<p><b>Change coordinates:</b></p>

The following examples shows how to change molecule coordinates:

<pre class="button">
set nmdhandle [lindex [nmwiz list] end]
set zeros [vecscale 0 [$nmdhandle getcoords]]
$nmdhandle setcoords $zeros
</pre>


<h3>Author</h3>
<p><a href="http://www.csb.pitt.edu/People/abakan/">Ahmet Bakan</a></p>

<p><i>Citation:</i> Bakan A, Meireles LM, Bahar I
<a href="http://bioinformatics.oxfordjournals.org/content/27/11/1575" target="_blank">
ProDy: Protein Dynamics Inferred from Theory and Experiments</a> 
<em>Bioinformatics</em> <strong>2011</strong> 27(11):1575-1577.</p>
